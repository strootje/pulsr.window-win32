cmake_minimum_required(VERSION 3.1.0)
project(Pulsr.Window VERSION 0.1.0 LANGUAGES CXX)


set(DIR_BASE ${CMAKE_CURRENT_SOURCE_DIR})
set(DIR_HEADERS ${DIR_BASE}/include)
set(DIR_SOURCES ${DIR_BASE}/src)
set(DIR_TESTS ${DIR_BASE}/tests)

set(TARGET_NAME ${PROJECT_NAME})
set(TARGET_COMPILER_FLAGS "")
set(TARGET_LINKED_FLAGS "")
set(TARGET_SOURCES
	${DIR_SOURCES}/Manager.cpp
	${DIR_SOURCES}/Window.cpp)
set(TARGET_DEPS Grawlog Pulsr.Core)


if ("${CMAKE_CXX_COMPILER_ID}" STREQUAL "MSVC")
	set(TARGET_COMPILER_FLAGS "${TARGET_COMPILER_FLAGS} /std:c++latest")
elseif("${CMAKE_CXX_COMPILER_ID}" STREQUAL "Clang")
	set(TARGET_COMPILER_FLAGS "${TARGET_COMPILER_FLAGS} -std=c++0z")
else()
endif()


set(${PROJECT_NAME}_INCLUDE_DIR ${DIR_HEADERS} PARENT_SCOPE)
set(${PROJECT_NAME}_BINARY_DIR ${CMAKE_CURRENT_BINARY_DIR}/${CMAKE_BUILD_TYPE} PARENT_SCOPE)
set(${PROJECT_NAME}_LIBRARIES ${TARGET_NAME} PARENT_SCOPE)
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${TARGET_COMPILER_FLAGS}")
set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} ${TARGET_LINKED_FLAGS}")


add_library(${TARGET_NAME} ${TARGET_SOURCES})
target_include_directories(${TARGET_NAME} PRIVATE ${DIR_HEADERS})

if(WIN32)
	set_target_properties(${TARGET_NAME} PROPERTIES COMPILE_FLAGS "/wd4005")
endif()

foreach(DEP_NAME ${TARGET_DEPS})
	target_include_directories(${TARGET_NAME} PUBLIC ${${DEP_NAME}_INCLUDE_DIR})
	target_link_libraries(${TARGET_NAME} ${${DEP_NAME}_LIBRARIES})
endforeach()


get_target_property(BUILD_TARGET_TYPE ${TARGET_NAME} TYPE)
if((BUILD_TARGET_TYPE MATCHES ".*_LIBRARY") AND NOT (CMAKE_BINARY_DIR STREQUAL CMAKE_CURRENT_BINARY_DIR))
	set(BUILD_INCLUDE_DIR ${CMAKE_BINARY_DIR}/include)
	set(${PROJECT_NAME}_INCLUDE_DIR ${BUILD_INCLUDE_DIR} PARENT_SCOPE)

	add_custom_command(TARGET ${TARGET_NAME} POST_BUILD
		COMMAND ${CMAKE_COMMAND} -E copy_directory ${DIR_HEADERS} ${BUILD_INCLUDE_DIR}/${PROJECT_NAME}
		COMMENT "Copying header files")
endif()
